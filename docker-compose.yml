version: "3"
services:
  web:
    image: antilamer/thing-tracker:ssl2
    volumes:
    - /etc/letsencrypt/live/thing-tracker.ga:/etc/letsencrypt/live/thing-tracker.ga
    - /opt/logs/thing-tracker:/opt/logs/thing-tracker
    deploy:
      replicas: 2
      resources:
        limits:
          cpus: "0.3"
          memory: 250M
      restart_policy:
        condition: on-failure
    ports:
    - "443:8443"
    - "80:80"
    networks:
    - webnet
  rabbitmq-stomp:
    image: antilamer/rabbitmq-stomp:3.7
    deploy:
      placement:
        constraints:
        - node.role == manager
    ports:
    - "5672:5672"
    - "15672:15672"
    - "61613:61613"
networks:
  webnet: