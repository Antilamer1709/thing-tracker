<form novalidate #form="ngForm" (keydown.enter)="searchProfileExpenses(form)" (ngSubmit)="searchProfileExpenses(form)">

  <p-table [value]="result?.data" [lazy]="true" (onLazyLoad)="loadExpensesLazy($event)" [paginator]="true"
           [rows]="10" [rowsPerPageOptions]="[10,30,50,100,{showAll: 'All'}]" [responsive]="scrWithLess560"
           [totalRecords]="result?.totalElements" [loading]="loading">

    <ng-template pTemplate="caption">
      <div style="text-align: right">

        <div class="ui-g ui-fluid">
          <div class="ui-g-12">

            <div class="ui-g-12 ui-lg-2 ui-md-3 ui-sm-6 margin-top-10 font-size-16px" style="float: left">
              <span class="ui-float-label">
                <p-calendar
                  [(ngModel)]="searchDTO.filter.dateFrom"
                  [locale]="europeLocale"
                  dateFormat="dd.mm.yy"
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  [showIcon]="true"
                  [touchUI]="true"
                  yearRange="2019:2030"
                  title="Leave it empty if you want show all results"
                  id="dateFrom"
                  name="dateFrom">

                </p-calendar>
                <label for="dateFrom">Date From</label>
              </span>
            </div>

            <div class="ui-g-12 ui-lg-2 ui-md-3 ui-sm-6 margin-top-10 font-size-16px" style="float: left">
              <span class="ui-float-label">
                <p-calendar
                  [(ngModel)]="searchDTO.filter.dateTo"
                  [locale]="europeLocale"
                  dateFormat="dd.mm.yy"
                  [monthNavigator]="true"
                  [yearNavigator]="true"
                  [showIcon]="true"
                  [touchUI]="true"
                  [required]="true"
                  yearRange="2019:2030"
                  title="Today is default"
                  id="dateTo"
                  name="dateTo">
                </p-calendar>
                <label for="dateTo">Date To</label>
              </span>
            </div>

            <div class="ui-xl-1 ui-lg-3 ui-md-3 ui-sm-6 margin-top-10" style="float: right">
              <button pButton label="Clear" icon="fa fa-search" type="submit"></button>
            </div>

            <div class="ui-xl-1 ui-lg-3 ui-md-3 ui-sm-6 margin-top-10" style="float: right">
              <button pButton label="Search" icon="fa fa-search" type="submit"></button>
            </div>

          </div>
        </div>

      </div>
    </ng-template>

    <ng-template pTemplate="header">

      <!--HEADERS-->
      <tr>

        <th style="width: 100px" [pSortableColumn]="'id'">
          ID
          <p-sortIcon [field]="'id'"></p-sortIcon>
        </th>

        <th style="width: 15%" [pSortableColumn]="'price'">
          Price
          <p-sortIcon [field]="'price'"></p-sortIcon>
        </th>

        <th>
          Types
        </th>

        <th [pSortableColumn]="'comment'">
          Comment
          <p-sortIcon [field]="'comment'"></p-sortIcon>
        </th>

        <th [pSortableColumn]="'date'">
          Date
          <p-sortIcon [field]="'date'"></p-sortIcon>
        </th>

        <th style="width: 58px" *ngIf="showDeleteButton"></th>
      </tr>

      <!--FILTERS-->
      <tr>

        <th>
          <p-spinner [(ngModel)]="searchDTO.filter.id" title="ID of searched expenses"
                     id="headerId" name="headerId" type="number">
          </p-spinner>
        </th>

        <th>
          <p-spinner [(ngModel)]="searchDTO.filter.price" title="Price of searched expenses"
                     id="headerPrice" name="headerPrice" type="number">
          </p-spinner>
        </th>

        <th>
          <p-autoComplete
            [(ngModel)]="searchDTO.filter.expenseTypes"
            [suggestions]="expenseTypes"
            (completeMethod)="searchExpenseTypes($event)"
            (onSelect)="expenseTypesOnSelect($event); searchProfileExpenses(form)"
            (onKeyUp)="expenseTypesOnKeyUp($event); searchProfileExpenses(form)"
            (onBlur)="expenseTypesOnBlur($event); searchProfileExpenses(form)"
            (onUnselect)="onUnselect($event); searchProfileExpenses(form)"
            [multiple]="true"
            name="types"
            id="types">
          </p-autoComplete>
        </th>

        <th>
          <input [(ngModel)]="searchDTO.filter.comment" title="Comment of searched expenses"
                 id="headerComment" name="headerComment"
                 type="text" size="255" pInputText>
        </th>

      </tr>

    </ng-template>

    <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
      <tr>

        <td>
          {{rowData.id}}
        </td>

        <td>
          {{rowData.price}}
        </td>

        <td>
          {{rowData.types}}
        </td>

        <td>
          {{rowData.comment}}
        </td>

        <td>
          {{rowData.date | date: 'dd.MM.yyyy HH:mm'}}
        </td>

        <td *ngIf="showDeleteButton">
          <button pButton (click)="showDeleteRow(rowData)" type="button" icon="pi pi-trash"></button>
        </td>

      </tr>
    </ng-template>

  </p-table>

</form>


<p-confirmDialog icon="pi pi-exclamation-triangle"></p-confirmDialog>
